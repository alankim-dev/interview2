<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>구조화된 면접 질문 생성기 v3 (Parser Fix)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 기본 폰트 설정 */
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
        }
        /* 로딩 스피너 스타일 */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* 생성된 컨텐츠 스타일 */
        #output h2 {
            @apply text-2xl font-bold mt-10 mb-5 border-b border-gray-300 pb-3;
        }
        #output h3 {
            @apply text-xl font-semibold mt-6 mb-3 text-gray-800;
        }
        #output h4 {
            @apply text-lg font-medium mt-5 mb-2 text-indigo-700;
        }
        #output .question {
            @apply text-gray-700 ml-4 mb-3 p-3 bg-gray-50 rounded-md;
        }
        #output table {
            @apply w-full border-collapse mt-4 shadow-sm rounded-lg;
        }
        #output th, #output td {
            @apply border border-gray-300 p-3 text-left;
        }
        #output th {
            @apply bg-gray-100 font-semibold;
        }
        #output td:first-child {
            @apply font-medium;
        }
        #output .rubric-grade {
            @apply block text-sm font-bold text-gray-600 mb-1;
        }
        #output .rubric-desc {
            @apply text-sm text-gray-700;
        }
        #output .definitions {
            @apply mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200;
        }
        #output .definitions p {
            @apply mb-2;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-6 md:p-10 max-w-7xl bg-white shadow-xl rounded-lg my-10">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">구조화된 면접 질문 및 평가 가이드 생성기</h1>
        <p class="text-gray-600 mb-8">직무, S&K 레벨, R&R 레벨을 선택하시면, 해당 포지션에 최적화된 면접 질문과 평가 루브릭을 생성합니다.</p>

        <!-- 컨트롤 영역 -->
        <div class="controls grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4 p-4 bg-gray-50 rounded-lg border">
            <div>
                <label for="jobGroupSelect" class="block text-sm font-medium text-gray-700 mb-1">1. 직무 (Job Group)</label>
                <select id="jobGroupSelect" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="">직무를 선택하세요...</option>
                </select>
            </div>
            <div>
                <label for="skSelect" class="block text-sm font-medium text-gray-700 mb-1">2. S&K Level (검증 목표)</label>
                <select id="skSelect" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="">S&K 레벨 선택...</option>
                </select>
            </div>
            <div>
                <label for="rrSelect" class="block text-sm font-medium text-gray-700 mb-1">3. R&R Level (검증 목표)</label>
                <select id="rrSelect" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="">R&R 레벨 선택...</option>
                </select>
            </div>
        </div>
        
        <div class="flex flex-col sm:flex-row justify-between items-center mb-8 px-4 sm:px-0">
             <div class="bg-indigo-50 p-3 rounded-md border border-indigo-200 text-indigo-800">
                <span class="font-semibold">예상 직급 (Level Matrix 기준):</span>
                <span id="expectedLevelDisplay" class="font-bold text-lg ml-2">-</span>
            </div>
            <button id="generateButton" class="bg-indigo-600 text-white font-semibold py-2 px-6 rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 mt-4 sm:mt-0 w-full sm:w-auto">
                가이드 생성
            </button>
        </div>


        <!-- 로딩 및 에러 메시지 -->
        <div id="loading" class="hidden flex-col items-center justify-center py-10">
            <div class="loader"></div>
            <p class="text-gray-600 mt-4">면접 가이드를 생성 중입니다...</p>
        </div>
        <div id="error" class="hidden p-4 bg-red-100 border border-red-300 text-red-800 rounded-md"></div>
        <div id="welcome" class="p-6 bg-blue-50 border border-blue-200 text-blue-800 rounded-md">
            <h3 class="font-semibold">시작하기</h3>
            <p>상단의 드롭다운에서 '직무', 'S&K 레벨', 'R&R 레벨'을 선택한 후 '가이드 생성' 버튼을 클릭하세요.</p>
        </div>

        <!-- 결과 출력 영역 -->
        <div id="output" class="mt-8"></div>
    </div>

    <script>
// ... existing code ... -->
        // indicator.xlsx - Sheet1.csv 파서 (파일 구조에 맞춤)
        function parseIndicator(text) {
// ... existing code ... -->
            
            if ([keyIdx, jobIdx, gradeIdx, nameIdx, descIdx].includes(-1)) {
                let missing = [
                    'Concatenate', 'Job Group', 'Grade', '세부지표 키워드', '세부지표 설명'
                ].filter(h => headers.indexOf(h) === -1);
                throw new Error(`Indicator.csv에 필수 컬럼이 없습니다: [${missing.join(', ')}] (헤더: ${headers.join('|')})`);
            }
// ... existing code ... -->
        }
        // *** [FIX END] ***

        // 데이터 로드 및 UI 초기화
        async function loadData() {
            loadingEl.classList.remove('hidden');
            welcomeEl.classList.add('hidden');

            // *** [수정된 부분] ***
            // 파일 경로를 간단한 이름으로 변경
            const [matrixText, indicatorText] = await Promise.all([
                fetchAndParseCSV('level_matrix.csv'), // 'Development Review_채용 - Level Matrix.csv'
                fetchAndParseCSV('indicator.csv')     // 'indicator.xlsx - Sheet1.csv'
            ]);
            // *** [수정 끝] ***

            if (!matrixText || !indicatorText) {
// ... existing code ... -->
        }

        // 페이지 로드 시 데이터 초기화
        document.addEventListener('DOMContentLoaded', loadData);
    </script>

</body>
</html>

